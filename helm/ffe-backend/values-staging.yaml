# Staging Environment Values
# Use: helm install ffe helm/ffe-backend -f helm/ffe-backend/values-staging.yaml

replicaCount: 2

image:
  repository: finance-feedback-engine
  pullPolicy: Always
  tag: staging

# Service
service:
  type: ClusterIP
  port: 8000

# Ingress enabled with staging domain
ingress:
  enabled: true
  className: nginx
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-staging
    nginx.ingress.kubernetes.io/rate-limit: "100"
  hosts:
    - host: staging-ffe.three-rivers-tech.com
      paths:
        - path: /
          pathType: Prefix
    - host: staging-api.ffe.three-rivers-tech.com
      paths:
        - path: /api
          pathType: Prefix
  tls:
    - secretName: staging-ffe-tls
      hosts:
        - staging-ffe.three-rivers-tech.com
        - staging-api.ffe.three-rivers-tech.com

# Resources - Medium for staging
resources:
  limits:
    cpu: 750m
    memory: 1.5Gi
  requests:
    cpu: 250m
    memory: 512Mi

# Autoscaling for staging
autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 5
  targetCPUUtilizationPercentage: 75
  targetMemoryUtilizationPercentage: 80

# Health checks
livenessProbe:
  httpGet:
    path: /health
    port: 8000
  initialDelaySeconds: 45
  periodSeconds: 15
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /ready
    port: 8000
  initialDelaySeconds: 20
  periodSeconds: 10
  timeoutSeconds: 3
  failureThreshold: 2

# Environment
env:
  LOGGING_LEVEL: INFO
  ENVIRONMENT: staging

# Database (external)
database:
  external: true
  # Set via helm install: --set database.url="..."

# Vault enabled (optional)
vault:
  enabled: false
  role: ffe-staging
  secretPath: secret/data/staging/app

# Persistence enabled
persistence:
  enabled: true
  size: 5Gi
  storageClassName: standard
  mountPath: /app/data

# Pod disruption budget
podDisruptionBudget:
  enabled: true
  minAvailable: 1

# Secrets from external source
secrets:
  create: true
  data: {}

# Anti-affinity for HA
affinity:
  podAntiAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      - labelSelector:
          matchExpressions:
            - key: app.kubernetes.io/name
              operator: In
              values:
                - ffe-backend
        topologyKey: kubernetes.io/hostname
