# ============================================================
# Finance Feedback Engine 2.0 - Environment Variables
# ============================================================
# Copy this file to .env and fill in your actual values:
#   cp .env.example .env
#   nano .env  # or vim, code, etc.
#
# This file is the SINGLE SOURCE OF TRUTH for all configuration.
# YAML config files are no longer used.
# ============================================================

# ============================================================
# ENVIRONMENT & RUNTIME
# ============================================================
# Set to 'development' to skip API key validation (for local testing)
# Set to 'production' to enforce API key validation
ENVIRONMENT="development"

# ============================================================
# API AUTHENTICATION & BASE URL
# ============================================================
# Frontend API Base URL - Use:
#   - 'http://localhost:8000' for local development (npm run dev)
#   - 'http://backend:8000' for Docker containers (docker-compose)
#   - 'https://api.example.com' for production
VITE_API_BASE_URL="http://backend:8000"

# Production-grade API key for frontend authentication
# Generate a secure key: python3 -c "import secrets; print(secrets.token_urlsafe(48))"
# Add to backend: See docs/API_AUTHENTICATION.md
VITE_API_KEY="your-production-api-key-here"

# ============================================================
# POSTGRESQL DATABASE CONFIGURATION
# ============================================================
# PostgreSQL connection URL for production deployments
# Format: postgresql+psycopg2://user:password@host:port/database
DATABASE_URL="postgresql+psycopg2://ffe_user:changeme@postgres:5432/ffe"

# PostgreSQL Server Credentials (used by docker-compose)
POSTGRES_USER="ffe_user"
POSTGRES_PASSWORD="changeme"
POSTGRES_DB="ffe"
POSTGRES_PORT="5432"

# Connection Pool Configuration
# Tune these for your deployment scenario:
# - Normal: pool_size=20, max_overflow=10
# - High-load testing: pool_size=50, max_overflow=20
# - Single-worker: pool_size=5, max_overflow=0
DB_POOL_SIZE="20"
DB_POOL_OVERFLOW="10"
DB_POOL_RECYCLE="3600"
DB_POOL_TIMEOUT="30"
DB_ECHO="false"

# ============================================================
# ALPHA VANTAGE API
# ============================================================
# Get your API key: https://www.alphavantage.co/support/#api-key
ALPHA_VANTAGE_API_KEY="YOUR_ALPHA_VANTAGE_API_KEY"

# ============================================================
# TRADING PLATFORM
# ============================================================
# Options: 'coinbase_advanced', 'oanda', 'mock', 'unified'
TRADING_PLATFORM="coinbase_advanced"

# ============================================================
# PLATFORM CREDENTIALS - COINBASE
# ============================================================
# Get API keys: https://www.coinbase.com/settings/api
COINBASE_API_KEY="YOUR_COINBASE_API_KEY"
COINBASE_API_SECRET="YOUR_COINBASE_API_SECRET"
COINBASE_USE_SANDBOX="false"

# ============================================================
# PLATFORM CREDENTIALS - OANDA
# ============================================================
# Get credentials: https://www.oanda.com/
OANDA_API_KEY="YOUR_OANDA_API_TOKEN"
OANDA_ACCOUNT_ID="YOUR_OANDA_ACCOUNT_ID"
OANDA_ENVIRONMENT="practice"  # 'practice' or 'live'

# ============================================================
# DECISION ENGINE
# ============================================================
# AI Provider: 'local', 'cli', 'codex', 'qwen', 'gemini', 'ensemble'
DECISION_ENGINE_AI_PROVIDER="local"
DECISION_ENGINE_MODEL_NAME="llama3.2:3b-instruct-q4_0"
DECISION_ENGINE_DECISION_THRESHOLD="0.7"

# Gemini API Configuration (if using 'gemini' provider)
DECISION_ENGINE_GEMINI_API_KEY="YOUR_GEMINI_API_KEY"
DECISION_ENGINE_GEMINI_MODEL_NAME="gemini-pro"

# ============================================================
# ENSEMBLE CONFIGURATION
# ============================================================
# Voting strategy: 'weighted', 'majority', or 'stacking'
ENSEMBLE_VOTING_STRATEGY="weighted"

# Provider weights (must sum to 1.0)
ENSEMBLE_PROVIDER_WEIGHT_LLAMA="0.16666667"
ENSEMBLE_PROVIDER_WEIGHT_DEEPSEEK="0.16666667"
ENSEMBLE_PROVIDER_WEIGHT_MISTRAL="0.16666667"
ENSEMBLE_PROVIDER_WEIGHT_QWEN25="0.16666667"
ENSEMBLE_PROVIDER_WEIGHT_GEMMA2="0.16666667"
ENSEMBLE_PROVIDER_WEIGHT_QWEN="0.16666666"

# Debate mode configuration
ENSEMBLE_DEBATE_MODE="true"
ENSEMBLE_DEBATE_BULL_PROVIDER="local"
ENSEMBLE_DEBATE_BEAR_PROVIDER="local"
ENSEMBLE_DEBATE_JUDGE_PROVIDER="local"

# Agreement and learning
ENSEMBLE_AGREEMENT_THRESHOLD="0.6"
ENSEMBLE_ADAPTIVE_LEARNING="true"
ENSEMBLE_LEARNING_RATE="0.1"

# ============================================================
# TWO-PHASE ENSEMBLE (Smart Premium API Management)
# ============================================================
TWO_PHASE_ENABLED="true"
TWO_PHASE_PHASE1_MIN_QUORUM="3"
TWO_PHASE_PHASE1_CONFIDENCE_THRESHOLD="0.75"
TWO_PHASE_PHASE1_AGREEMENT_THRESHOLD="0.6"
TWO_PHASE_REQUIRE_PREMIUM_FOR_HIGH_STAKES="true"
TWO_PHASE_HIGH_STAKES_POSITION_THRESHOLD="1000"

# Asset-based routing
TWO_PHASE_ASSET_ROUTING_CRYPTO="cli"
TWO_PHASE_ASSET_ROUTING_FOREX="gemini"
TWO_PHASE_ASSET_ROUTING_STOCK="gemini"
TWO_PHASE_ASSET_ROUTING_FALLBACK="gpt-oss:120b-cloud"
TWO_PHASE_ASSET_ROUTING_CODEX_AS_TIEBREAKER="true"
TWO_PHASE_ASSET_ROUTING_MAX_PREMIUM_CALLS_PER_DAY="50"

# ============================================================
# MONITORING
# ============================================================
MONITORING_ENABLE_CONTEXT_INTEGRATION="true"
MONITORING_ENABLED="false"
MONITORING_MANUAL_CLI="false"
MONITORING_PULSE_INTERVAL_SECONDS="300"
MONITORING_INCLUDE_SENTIMENT="true"
MONITORING_INCLUDE_MACRO="false"
MONITORING_ENABLE_LIVE_VIEW="false"

# Live view configuration
MONITORING_LIVE_VIEW_REFRESH_FAST="2"
MONITORING_LIVE_VIEW_REFRESH_MEDIUM="5"
MONITORING_LIVE_VIEW_REFRESH_SLOW="10"
MONITORING_LIVE_VIEW_REFRESH_LAZY="30"

# Panel visibility
MONITORING_LIVE_VIEW_PANEL_AGENT_STATUS="true"
MONITORING_LIVE_VIEW_PANEL_PORTFOLIO="true"
MONITORING_LIVE_VIEW_PANEL_ACTIVE_TRADES="true"
MONITORING_LIVE_VIEW_PANEL_MARKET_PULSE="true"
MONITORING_LIVE_VIEW_PANEL_RECENT_DECISIONS="true"
MONITORING_LIVE_VIEW_PANEL_PERFORMANCE="true"

# Decision log settings
MONITORING_LIVE_VIEW_DECISION_LOG_MAX_ENTRIES="10"
MONITORING_LIVE_VIEW_DECISION_LOG_SHOW_REASONING="true"
MONITORING_LIVE_VIEW_DECISION_LOG_MAX_REASONING_LENGTH="200"

# Performance panel
MONITORING_LIVE_VIEW_PERFORMANCE_LOOKBACK_HOURS="24"

# ============================================================
# PERSISTENCE
# ============================================================
PERSISTENCE_STORAGE_PATH="data/decisions"
PERSISTENCE_MAX_DECISIONS="1000"
PERSISTENCE_CLEANUP_DAYS="30"

# ============================================================
# PORTFOLIO MEMORY ENGINE
# ============================================================
PORTFOLIO_MEMORY_ENABLED="true"
PORTFOLIO_MEMORY_MAX_MEMORY_SIZE="1000"
PORTFOLIO_MEMORY_LEARNING_RATE="0.1"
PORTFOLIO_MEMORY_CONTEXT_WINDOW="20"

# ============================================================
# TELEGRAM NOTIFICATIONS (Optional)
# ============================================================
TELEGRAM_ENABLED="false"
TELEGRAM_BOT_TOKEN="YOUR_TELEGRAM_BOT_TOKEN"
TELEGRAM_CHAT_ID="YOUR_TELEGRAM_CHAT_ID"
TELEGRAM_NGROK_AUTH_TOKEN="YOUR_NGROK_AUTH_TOKEN"
TELEGRAM_ALLOWED_USER_IDS="YOUR_USER_ID"

# ============================================================
# BACKTESTING
# ============================================================
BACKTESTING_ENABLED="false"
BACKTESTING_USE_REAL_DATA="false"
BACKTESTING_INITIAL_BALANCE="10000.0"
BACKTESTING_FEE_PERCENTAGE="0.1"

# Strategy configuration
BACKTESTING_STRATEGY_NAME="sma_crossover"
BACKTESTING_STRATEGY_SHORT_WINDOW="5"
BACKTESTING_STRATEGY_LONG_WINDOW="20"

# Reinforcement learning
BACKTESTING_RL_LEARNING_RATE="0.01"
BACKTESTING_RL_DISCOUNT_FACTOR="0.95"
BACKTESTING_RL_EXPLORATION_RATE="0.1"

# ============================================================
# SAFETY & EXECUTION CONTROLS
# ============================================================
SAFETY_MAX_LEVERAGE="5.0"
SAFETY_MAX_POSITION_PCT="25.0"

# ============================================================
# CIRCUIT BREAKER
# ============================================================
CIRCUIT_BREAKER_FAILURE_THRESHOLD="3"
CIRCUIT_BREAKER_RECOVERY_TIMEOUT_SECONDS="300"
CIRCUIT_BREAKER_HALF_OPEN_RETRY="1"

# ============================================================
# LOGGING
# ============================================================
LOGGING_LEVEL="INFO"

# Structured logging
LOGGING_STRUCTURED_ENABLED="true"
LOGGING_STRUCTURED_FORMAT="json"
LOGGING_STRUCTURED_CORRELATION_IDS="true"
LOGGING_STRUCTURED_PII_REDACTION="true"

# File output
LOGGING_FILE_ENABLED="true"
LOGGING_FILE_BASE_PATH="logs"
LOGGING_FILE_ROTATION_MAX_BYTES="10485760"
LOGGING_FILE_ROTATION_BACKUP_COUNT="30"

# Retention policies (days)
LOGGING_RETENTION_HOT_TIER="7"
LOGGING_RETENTION_WARM_TIER="30"
LOGGING_RETENTION_COLD_TIER="365"

# ============================================================
# TRADING AGENT (Risk Gatekeeper)
# ============================================================
AGENT_AUTONOMOUS_EXECUTION="false"
AGENT_APPROVAL_POLICY="on_new_asset"
AGENT_MAX_DAILY_TRADES="5"
AGENT_STRATEGIC_GOAL="balanced"
AGENT_RISK_APPETITE="medium"

# Autonomous mode
AGENT_AUTONOMOUS_ENABLED="false"
AGENT_AUTONOMOUS_PROFIT_TARGET="0.05"
AGENT_AUTONOMOUS_STOP_LOSS="0.02"

# Risk gatekeeper
AGENT_CORRELATION_THRESHOLD="0.7"
AGENT_MAX_CORRELATED_ASSETS="2"
AGENT_MAX_VAR_PCT="0.05"
AGENT_VAR_CONFIDENCE="0.95"

# ============================================================
# API AUTHENTICATION
# ============================================================
API_AUTH_RATE_LIMIT_MAX="100"
API_AUTH_RATE_LIMIT_WINDOW="60"
API_AUTH_ENABLE_FALLBACK_TO_CONFIG="false"

# ============================================================
# API TIMEOUTS (seconds)
# ============================================================
# Data providers
API_TIMEOUT_MARKET_DATA="10"
API_TIMEOUT_SENTIMENT="15"
API_TIMEOUT_MACRO="10"

# Trading platforms
API_TIMEOUT_PLATFORM_BALANCE="5"
API_TIMEOUT_PLATFORM_PORTFOLIO="10"
API_TIMEOUT_PLATFORM_EXECUTE="30"
API_TIMEOUT_PLATFORM_CONNECTION="3"

# AI providers
API_TIMEOUT_LLM_QUERY="45"
API_TIMEOUT_LLM_DEBATE="90"
API_TIMEOUT_LLM_CONNECTION="5"

# External services
API_TIMEOUT_TELEGRAM_WEBHOOK="5"
API_TIMEOUT_REDIS_OPERATIONS="2"

# ============================================================
# BENCHMARK & OPTIMIZATION
# ============================================================
BENCHMARK_START_DATE="2024-01-01"
BENCHMARK_END_DATE="2024-12-01"
BENCHMARK_FREQUENCY="5"
BENCHMARK_SAVE_REPORTS="true"
BENCHMARK_REPORTS_DIRECTORY="data/benchmarks"

# ============================================================
# REFACTORING
# ============================================================
REFACTORING_MAX_CONCURRENT="1"
REFACTORING_DEGRADATION_THRESHOLD="-0.05"
REFACTORING_BENCHMARK_FREQUENCY="5"
REFACTORING_USE_GIT="true"
REFACTORING_AUTO_ROLLBACK="true"
REFACTORING_OUTPUT_DIRECTORY="data/refactoring"

# ============================================================
# OPTIMIZATION (Optuna)
# ============================================================
OPTIMIZATION_N_TRIALS="50"
OPTIMIZATION_OPTIMIZE_FOR="sharpe_ratio"
OPTIMIZATION_SAVE_RESULTS="true"
OPTIMIZATION_RESULTS_DIRECTORY="data/optimization"

# Search spaces
OPTIMIZATION_STOP_LOSS_PCT_MIN="0.01"
OPTIMIZATION_STOP_LOSS_PCT_MAX="0.05"
OPTIMIZATION_POSITION_SIZE_PCT_MIN="0.005"
OPTIMIZATION_POSITION_SIZE_PCT_MAX="0.02"
OPTIMIZATION_CONFIDENCE_THRESHOLD_MIN="0.65"
OPTIMIZATION_CONFIDENCE_THRESHOLD_MAX="0.85"
OPTIMIZATION_RSI_PERIOD_MIN="10"
OPTIMIZATION_RSI_PERIOD_MAX="20"
OPTIMIZATION_ATR_MULTIPLIER_MIN="1.5"
OPTIMIZATION_ATR_MULTIPLIER_MAX="3.0"

# ============================================================
# ERROR TRACKING (PRODUCTION MONITORING)
# ============================================================
# Centralized error tracking for production monitoring
# Use Sentry for cloud monitoring or logging for local/development
#
# Production Setup:
# 1. Create account at sentry.io
# 2. Create new project for Finance Feedback Engine
# 3. Copy DSN from project settings
# 4. Set ERROR_TRACKING_ENABLED="true"
# 5. Set ERROR_TRACKING_BACKEND="sentry"
# 6. Set SENTRY_DSN to your project's DSN
#
# Development Setup:
# - Leave ERROR_TRACKING_ENABLED="false" or use backend="logging"
# - Errors will be logged locally without remote tracking

# Enable/disable error tracking
ERROR_TRACKING_ENABLED="false"

# Backend: sentry (cloud), logging (local), file (local)
ERROR_TRACKING_BACKEND="logging"

# Sentry DSN (only needed if backend=sentry)
# Get from: https://sentry.io/settings/<org>/projects/<project>/keys/
SENTRY_DSN=""

# Performance trace sample rate (0.0-1.0)
# Recommended: 0.1 in production (10% of requests)
SENTRY_TRACES_SAMPLE_RATE="0.1"
