# Finance Feedback Engine 2.0 Configuration

# Alpha Vantage API Configuration
# Get your free or premium API key at: https://www.alphavantage.co/support/#api-key
alpha_vantage_api_key: "YOUR_ALPHA_VANTAGE_API_KEY"

# Trading Platform Configuration
# Options: 'coinbase', 'coinbase_advanced', 'oanda', 'mock', 'unified'
# - coinbase/coinbase_advanced: Crypto trading with futures portfolio tracking
# - oanda: Forex trading with position & margin tracking
# - mock: Testing without real API (simulated data)
# - unified: Multi-platform mode (configure 'platforms' list below)
#
# Single Platform Mode: Set one platform name (legacy)
trading_platform: "coinbase_advanced"
#
# Multi-Platform Mode: Use 'unified' and configure platforms list below
# trading_platform: "unified"

# Platform-specific credentials
# Uncomment and configure based on your chosen platform
platform_credentials:
  # ============================================
  # Option 1: Coinbase Advanced (Crypto Futures)
  # ============================================
  # Get your API keys from: https://www.coinbase.com/settings/api
  api_key: "YOUR_COINBASE_API_KEY"
  api_secret: "YOUR_COINBASE_API_SECRET"
  use_sandbox: false  # true for testing, false for production
  # passphrase: "YOUR_PASSPHRASE"  # optional, for legacy API only

  # ============================================
  # Option 2: Oanda (Forex Trading)
  # ============================================
  # Get credentials from: https://www.oanda.com/
  # 1. Create account (practice or live)
  # 2. Generate Personal Access Token
  # 3. Find account ID in dashboard (format: 001-XXX-XXXXXXX-XXX)
  # Uncomment below if using Oanda:
  #
  # api_key: "YOUR_OANDA_API_TOKEN"
  # account_id: "YOUR_OANDA_ACCOUNT_ID"
  # environment: "practice"  # 'practice' for demo, 'live' for real money

  # ============================================
  # Option 3: Mock Platform (Testing)
  # ============================================
  # No credentials needed - uses simulated data
  # Set trading_platform: "mock" above

# ============================================
# Data Providers (UnifiedDataProvider Credentials)
# ============================================
# Structured credentials used by internal monitoring and data fetchers.
# If present, these take precedence for unified data access.
providers:
  alpha_vantage:
    api_key: "${alpha_vantage_api_key}"
  coinbase:
    credentials:
      api_key: "${platform_credentials.api_key}"
      api_secret: "${platform_credentials.api_secret}"
      use_sandbox: ${platform_credentials.use_sandbox}
  oanda:
    credentials:
      api_key: "${platform_credentials.api_key}"
      account_id: "${platform_credentials.account_id}"
      environment: "${platform_credentials.environment}"

# ============================================
# Multi-Platform Configuration (Advanced)
# ============================================
# To use multiple platforms simultaneously:
# 1. Set trading_platform: "unified" above
# 2. Uncomment and configure platforms list below
# 3. Dashboard aggregates portfolio across all platforms
#
# platforms:
#   - name: "coinbase_advanced"
#     credentials:
#       api_key: "YOUR_COINBASE_API_KEY"
#       api_secret: "YOUR_COINBASE_API_SECRET"
#       use_sandbox: false
#
#   - name: "oanda"
#     credentials:
#       api_key: "YOUR_OANDA_API_TOKEN"
#       account_id: "YOUR_OANDA_ACCOUNT_ID"
#       environment: "practice"
#
# NOTE: When using unified platform mode:
# - Execute trades on specific platform: specify platform_name in decision
# - View aggregated portfolio: python main.py portfolio (uses dashboard aggregator)
# - Balances shown separately per platform in 'balance' command

# Decision Engine Configuration
decision_engine:
  # AI Provider Options:
  # - 'local': Free Llama-3.2-3B via Ollama (auto-installed)
  # - 'cli': GitHub Copilot CLI
  # - 'codex': Codex CLI
  # - 'qwen': Free Qwen CLI (requires Node.js v20+)
  # - 'gemini': Free Google Gemini CLI (requires Node.js v20+)
  # - 'ensemble': Aggregate multiple providers for best signals
  ai_provider: "local"

  # Model name/path (provider-specific)
  model_name: "llama3.2:3b-instruct-fp16"

  # Local models list for ensemble (optional, defaults to auto-discovery)
  # local_models: ["llama3.2:3b-instruct-fp16", "mistral:7b-instruct"]

  # Local priority mode: boost local providers in ensemble
  # Options: false (disabled), true (2x boost), "soft" (1.5x boost), or number (custom multiplier)
  # local_priority: "soft"

  # Decision confidence threshold (0.0 - 1.0)
  # Only execute trades above this confidence level
  decision_threshold: 0.7

  # Custom prompt template (optional)
  # prompt_template: "path/to/custom_prompt.txt"

# Ensemble Configuration (only used if ai_provider: "ensemble")
ensemble:
  # Which providers to include in ensemble
  # Only enable providers you have configured
  # Two-phase mode uses: enabled_providers (free/local quorum), escalates to premium_providers when needed
  enabled_providers:
    - llama3.2:3b-instruct-fp16
    - deepseek-r1:8b
    - mistral:7b-instruct
    - qwen2.5:7b-instruct
    - gemma2:9b
    - qwen

  # Initial weights for each provider (must sum to 1.0)
  provider_weights:
    llama3.2:3b-instruct-fp16: 0.16666667
    deepseek-r1:8b: 0.16666667
    mistral:7b-instruct: 0.16666667
    qwen2.5:7b-instruct: 0.16666667
    gemma2:9b: 0.16666667
    qwen: 0.16666666
    # NOTE: Premium providers (cli, gemini, gpt-oss:120b-cloud) are NOT weighted here;
    # they are used conditionally in asset_routing for Phase 2 escalation

  # Voting strategy: 'weighted', 'majority', or 'stacking'
  voting_strategy: "weighted"


  # Debate mode: Enable structured debate between providers
  # When enabled, uses bull/bear/judge workflow instead of ensemble voting
  # DEFAULT: true - uses local providers by default for safety
  # Can be customized to use premium providers (gemini, qwen) when API keys available
  debate_mode: true

  # Debate providers: Specify which providers play which roles
  # Default: Uses all local providers for zero-cost multi-model consensus
  debate_providers:
    bull: "local"     # Provider for bullish case
    bear: "local"     # Provider for bearish case
    judge: "local"    # Provider for final judgment

  # Minimum agreement threshold (0.0-1.0)
  # Higher = requires more consensus between providers
  agreement_threshold: 0.6

  # Adaptive learning: adjust weights based on accuracy
  # TESTED: Dynamic weight adjustment, ensemble fallback system
  adaptive_learning: true  # ON BY DEFAULT - thoroughly tested
  learning_rate: 0.1

# ============================================
# Two-Phase Ensemble (Smart Premium API Management)
# ============================================
# Phase 1: Query enabled_providers (free/local quorum)
#   - Requires minimum 3 successful responses (quorum)
#   - Calculates weighted consensus
# Phase 2: Escalate to premium_providers if:
#   - Phase 1 confidence < threshold OR
#   - Phase 1 agreement < threshold OR
#   - High-stakes position detected
# Asset-based routing: Crypto→cli, Forex→gemini, Stock→gemini, Fallback→gpt-oss:120b-cloud
  two_phase:
    # Enable two-phase mode (default: false for backward compatibility)
    enabled: true

    # Phase 1 quorum: minimum successful free providers required
    phase1_min_quorum: 3

    # Phase 1 confidence threshold (0.0-1.0)
    # Escalate to Phase 2 if confidence below this
    phase1_confidence_threshold: 0.75

    # Phase 1 agreement threshold (0.0-1.0)
    # Escalate if weighted vote share for winning action < this
    phase1_agreement_threshold: 0.6

    # Require premium providers for high-stakes trades
    require_premium_for_high_stakes: true

    # High-stakes position threshold (USD)
    high_stakes_position_threshold: 1000

    # Asset-based routing using premium_providers
    asset_routing:
      crypto: "cli"      # Copilot for crypto analysis
      forex: "gemini"    # Gemini for forex analysis
      stock: "gemini"    # Gemini for stock analysis
      fallback: "gpt-oss:120b-cloud"  # OSS 120B cloud model as fallback

      # Call Codex as tiebreaker when primary agrees with Phase 1
      codex_as_tiebreaker: true

      # Maximum premium API calls per day (budget enforcement)
      max_premium_calls_per_day: 50

# ============================================
# Live Trading Monitoring
# ============================================
# Provides real-time position awareness to AI decision engine
# TESTED: Monitoring integration tests, context provider validation
monitoring:
  # Enable monitoring context integration (AI position awareness)
  enable_context_integration: true  # ON BY DEFAULT - thoroughly tested
  # Auto-start internal TradeMonitor (no manual CLI exposure)
  enabled: false  # Set true to start TradeMonitor automatically
  # Allow legacy manual CLI monitor commands (start/status/metrics)
  manual_cli: false  # Keep false for safety; true re-enables commands
  # Pulse interval for multi-timeframe cached analysis
  pulse_interval_seconds: 300

  # Include sentiment data in market analysis
  include_sentiment: true  # Alpha Vantage NEWS_SENTIMENT API

  # Include macro indicators in market analysis
  include_macro: false  # Real GDP, inflation, Fed Funds, unemployment

# Persistence Configuration
persistence:
  # Path to store trading decisions
  storage_path: "data/decisions"

  # Maximum decisions to keep in memory
  max_decisions: 1000

  # Auto-cleanup old decisions (days)
  cleanup_days: 30

# ============================================
# Portfolio Memory Engine
# ============================================
# Tracks trade outcomes and provides learning-based recommendations
# Inspired by reinforcement learning (experience replay, Thompson sampling)
# TESTED: Phase 1 integration tests, portfolio memory implementation
portfolio_memory:
  # Enable portfolio memory tracking
  enabled: true  # ON BY DEFAULT - thoroughly tested

  # Maximum experiences to retain in memory buffer
  max_memory_size: 1000

  # Learning rate for provider weight updates (0.0-1.0)
  # Higher = faster adaptation, Lower = more stable
  learning_rate: 0.1

  # Number of recent trades to include in AI context
  context_window: 20

# ============================================
# Telegram Notifications (Optional)
# ============================================
# Send alerts for Phase 1 quorum failures and trade executions
# TODO: Implement Telegram Bot API integration
telegram:
  # Enable Telegram notifications
  enabled: false

  # Telegram Bot API token (from @BotFather)
  bot_token: null

  # Telegram chat ID (your user ID or group ID)
  chat_id: null

# ============================================
# Backtesting (Experimental)
# ============================================
# Run historical strategy simulations
backtesting:
  # Enable backtesting (manual toggle)
  enabled: false

  # Use real historical data from AlphaVantage (requires API key)
  # If false, uses synthetic candles
  use_real_data: false

  # Starting paper balance for simulations
  initial_balance: 10000.0

  # Per-trade fee as percentage of notional (0.1 = 0.1%)
  fee_percentage: 0.1

  # Default strategy configuration
  strategy:
    name: "sma_crossover"  # Options: sma_crossover, ensemble_weight_rl
    short_window: 5        # Fast moving average period
    long_window: 20        # Slow moving average period

  # Reinforcement learning config (for RL strategies)
  rl:
    learning_rate: 0.01
    discount_factor: 0.95
    exploration_rate: 0.1

# ============================================
...existing code...

# ============================================
# Safety & Execution Controls
# ============================================
# Prevent unsafe automated executions and provide circuit breaker protection
safety:
  # Safety thresholds used during pre-execution monitoring checks
  max_leverage: 5.0           # block execution above this leverage estimate
  max_position_pct: 25.0      # block execution if largest position > this percent

# Circuit breaker tuning (process-local)
circuit_breaker:
  failure_threshold: 3        # number of consecutive failures to open the breaker
  recovery_timeout_seconds: 300
  half_open_retry: 1

# ============================================
# Signal-Only Mode
# ============================================
# Force signal-only mode globally (no position sizing or execution)
# signal_only_default: false

# ============================================
# Logging Configuration (Optional)
# ============================================
logging:
  # Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
  level: "INFO"

  # Optional: Log file path (if omitted, logs to console only)
  # file: "logs/finance_engine.log"

# ============================================
# Trading Agent (Risk Gatekeeper)
# ============================================
agent:
  # Execution controls
  autonomous_execution: false
  approval_policy: on_new_asset
  max_daily_trades: 5
  strategic_goal: balanced
  risk_appetite: medium
  autonomous:
    enabled: false
    profit_target: 0.05   # 5%
    stop_loss: 0.02       # 2%

  # RiskGatekeeper configuration (decimal fractions)
  correlation_threshold: 0.7   # 70%
  max_correlated_assets: 2
  max_var_pct: 0.05            # 5%
  var_confidence: 0.95         # 95%

# ============================================
# USAGE NOTES
# ============================================
#
# Quick Start:
# 1. Set your alpha_vantage_api_key above
# 2. Choose your trading_platform (coinbase_advanced or oanda)
# 3. Add platform credentials for your chosen platform
# 4. Choose ai_provider (local is easiest - no setup required)
#
# CLI Commands:
# - python main.py status              # Check account & platform
# - python main.py balance             # Quick balance check
# - python main.py portfolio           # Detailed holdings (if supported)
# - python main.py analyze BTCUSD      # Get AI trading signal
# - python main.py history --limit 20  # View past decisions
# - python main.py execute <id>        # Execute a decision
#
# Platform-Specific Notes:
#
# Coinbase Advanced (Crypto Futures):
# - Supports: BTC, ETH futures trading
# - Portfolio tracking: positions, P&L, margin
# - Asset format: BTCUSD, ETHUSD
# - Install: pip install coinbase-advanced-py
#
# Oanda (Forex):
# - Supports: All major/cross/exotic forex pairs
# - Portfolio tracking: positions, P&L, margin, currency exposure
# - Asset format: EUR_USD, GBP_USD (use underscore)
# - Install: pip install oandapyV20
# - Environments: 'practice' (demo) or 'live' (real money)
#
# AI Providers:
# - local: Free, no API costs, runs on CPU (4-8GB RAM)
# - cli/codex: Requires GitHub Copilot subscription
# - qwen: Free, requires Node.js v20+ and OAuth
# - gemini: Free, requires Node.js v20+ and OAuth or API key
# - ensemble: Combines multiple providers for better accuracy
#
# For more details, see:
# - README.md
# - USAGE.md
# - docs/OANDA_INTEGRATION.md (forex)
# - docs/PORTFOLIO_TRACKING.md (crypto)
# - docs/ENSEMBLE_SYSTEM.md (multi-provider AI)
